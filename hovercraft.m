
function ydot = hovercraft(y,ui)

    global Mass;%glbal 全局变量的意思
    global Iz;
    Mass = 164000;
    g = 9.81;
    Lc = 29.0;
    Sx = 83.0;
    Ix = 2.378e6;
    Iz = 1.696e7;
    Roua = 1.225;
    Rou = 1025;
    global vd_h;
    global rd_h;
    global Vwind;
    global Betawind;
    global VA;
    global Abeta;
    global piaojiao;
    global Tp_fig Nr_fig;
    global Xw Yw Nw;
    global N1_fig N2_fig N3_fig N4_fig;
    global k b0 dis Vduct2;
    global Xr Nr Xa Na Xh Nh Cer_X Cer_N;
    global Speed_wind Angle_wind;
    
    
    u = y(1);     %纵向速度
    v = y(2);      %横向速度
    x6 = y(8);     %Psi艏向角
    p = y(3);      %横倾角速度
    r = y(4);      %回转率
    
    
%%%%%%%%%%%%%相对风速和相对风向%%%%%%%%%%%%%%        
    ux = u;
    vx = v;
    %风速风向最大值限制
    if abs(ux)>120 
        ux=sign(ux)*120;
    end 
    if abs(vx)>120
        vx=sign(vx)*120;
    end

	Xwind=ux+Vwind*cosd(Betawind-x6*180/pi);
    Ywind=vx+Vwind*sind(Betawind-x6*180/pi);
	VA=((Xwind^2)+(Ywind^2))^0.5;   %相对风速
    
    Xwind0=u+Vwind*cosd(Betawind-x6*180/pi);%X方向相对风速
    Ywind0=v+Vwind*sind(Betawind-x6*180/pi);%Y方向相对风速
    if Xwind0>=0 && Ywind0==0
        Betaa=0;
    elseif Xwind0<0 && Ywind0==0 
        Betaa=pi;
    elseif Xwind0==0 && Ywind0>0 
        Betaa=pi/2;
    elseif Xwind0==0 && Ywind0<0 
        Betaa=-pi/2;
    elseif Xwind0>0 
        Betaa=atan(Ywind0/Xwind0);
    elseif Xwind0<0 && Ywind0>0 
        Betaa=pi+atan(Ywind0/Xwind0);
    else
        Betaa=-pi+atan(Ywind0/Xwind0);
    end
    Abeta=Betaa*180/pi;  %相对风向
    
%%%%%%%%%%%%%漂角（侧滑角）%%%%%%%%%%%%
    if u>=0 && v==0 
        Beta=0;
    elseif u<0 && v==0 
        Beta=pi;
    elseif u==0 && v>0 
        Beta=pi/2;
    elseif u==0 && v<0
        Beta=-pi/2;
    elseif u>0
        Beta=atan(v/u);
    elseif u<0 && v>0 
        Beta=pi+atan(v/u);
    else
        Beta=-pi+atan(v/u);
    end
	piaojiao=Beta*180/pi;%侧滑角-角度制
    piaojiao=real(piaojiao);

%%%%%%%%%%螺旋桨推力%%%%%%%%%%%%%%
    B = zeros(2,1);%左右螺距角
    Tprop = zeros(2,1);%左右推力
    Nprop = [1167.0;1167.0];%螺旋桨转速
    yp=[4.95;-4.95];%螺旋桨安装位置
    B(1) = ui(1);       %左螺距角初始化
    if B(1) > 40
        B(1) = 40;
    elseif B(1) <-25
        B(1) = -25;
    end
    B(2) = ui(2);       %右螺距角初始化
    if B(2) > 40
        B(2) = 40;
    elseif B(2) <-25
        B(2) = -25;
    end
    
%%%求螺旋桨 推力和回转力矩
    for j = 1:2
        Tprop(j) = (9830.4 + 2082.1*B(j)+23.199*B(j)^2-26.39*B(j)*Xwind+ 0.296*Xwind^2) *(Nprop(j)/1167)^2;
    end
    Tp = Tprop(1) + Tprop(2); 
    Np = -Tprop(1)*yp(1)-Tprop(2)*yp(2);  %显示20161107
    

%%%%%%%%%%%%%%%计算舵力%%%%%%%%%%%%%%%
    Sduct = 12.081;
    Sr = 2.4;
    xr = -13.772;
    yr = [4.95;-4.95];
    zr = -1.485;
    Rangle = zeros(2,1);
    Vduct2 = zeros(2,1);
    Pduct = zeros(2,1);
    Crx = zeros(2,1);
    Cry = zeros(2,1);
    Cp = zeros(2,1);
    Rangle(1) = ui(3);      %左舵角初始化
    if Rangle(1) > 30
        Rangle(1) = 30;
    elseif Rangle(1) <-30
        Rangle(1) = -30;
    end
    Rangle(2) = ui(4) ;     %右舵角初始化
    if Rangle(2) > 30
        Rangle(2) = 30;
    elseif Rangle(2) <-30
        Rangle(2) = -30;
    end
    for j = 1:2
        if Tprop(j) >= 0
            Vduct2(j) = (VA*cos(Betaa))^2 + Tprop(j)/(Roua*Sduct) + 2*VA * cos(Betaa)*(Tprop(j)/(Roua*Sduct))^0.5;
        else
            Vduct2(j) = (VA*cos(Betaa))^2 + abs(Tprop(j))/(2*Roua*Sduct) - 2*VA * cos(Betaa)*(abs(Tprop(j))/(Roua*Sduct))^0.5;
        end
        Pduct(j) = Roua * Vduct2(j)/2;
        if abs(Rangle(j)) <= 23
            Crx(j) = 0.0096 + 0.00116 * abs(Rangle(j))+0.000333*Rangle(j)^2;
            Cry(j) = 0.063*Rangle(j);
            Cp(j) = 0.01587*abs(Rangle(j));
        elseif abs(Rangle(j)) <= 25
            Crx(j) = -3.379 + 0.2516*abs(Rangle(j))-0.00415*Rangle(j)^2;
            Cry(j) = 0.063*Rangle(j);
            Cp(j) = 0.01587*abs(Rangle(j));
        else
            Crx(j) = -3.379 + 0.2516*abs(Rangle(j))-0.00415*Rangle(j)^2;
            Cry(j) = 43.75*sign(Rangle(j)) - 2.93*Rangle(j) + 0.05*Rangle(j)*abs(Rangle(j));
            Cp(j) = 5.96-0.419*abs(Rangle(j)) + 0.00785*Rangle(j)^2;
        end
    end
        Xr=-2*Sr*(Crx(1)*Pduct(1)+Crx(2)*Pduct(2));
        Yr=2*Sr*(Cry(1)*Pduct(1)+Cry(2)*Pduct(2));
        Kr=-Yr*zr;
        Nr=2*Crx(1)*Sr*(yr(1)+(0.2-0.8*Cp(1))*sin(Rangle(1)/57.3))*Pduct(1)+2*(xr+(0.2-0.8*Cp(1))*cos(Rangle(1)/57.3))*Sr*Cry(1)*Pduct(1) + ...
            2*Crx(2)*Sr*(yr(2)+(0.2-0.8*Cp(2))*sin(Rangle(2)/57.3))*Pduct(2)+2*(xr+(0.2-0.8*Cp(2))*cos(Rangle(2)/57.3))*Sr*Cry(2)*Pduct(2);  %显示20161107
%         Xr=0.5*Xr;
%         Yr=-0.5*Yr;
%         Kr=-0.5*Kr;
%         Nr=0.5*Nr;
%         disp('Nr')
%         disp(Nr)
 
%%%%%%%%重力及力矩%%%%%%%%%%%%%%
	Kgrav=-0.76*Mass*g*sin(y(7));
	Ngrav=0;
    
%%%%%%%%%%%%%%艏喷管力及力矩%%%%%%%%%%%%%%%%%
    xn =2.085;
    yn = [5.410;-5.410];
    zn = -1.485;   
    Tn1 = 6.492*ui(5);
    psin1 = ui(6);
    Tn2 = 6.492*ui(7);
    psin2 = ui(8);
    
    Xn = -Tn1*cos(psin1)-Tn2*cos(psin2);
    Yn = -Tn1*sin(psin1)-Tn2*sin(psin2);
    Kn = -zn*Yn;
    Nn = xn*Yn+(-1)*yn(1)*Tn1+(-1)*yn(2)*Tn2;
    

%%%%%%%%%%%%%%%%%侧风门力及力矩%%%%%%%%%%%%%%%%%%%%
	sidewind1=ui(9);
    sidewind2=ui(10);
    sidewind3=ui(11);
    sidewind4=ui(12);
    Xs=0;
	Ys=2718.8*sidewind1+2718.8*sidewind2-2718.8*sidewind3-2718.8*sidewind4;
	Ks=-2718.8*sidewind1*0.415-2718.8*sidewind2*0.415+2718.8*sidewind3*0.415+2718.8*sidewind4*0.415;
	Ns=2718.8*8.908*sidewind1-2718.8*10.477*sidewind2-2718.8*8.908*sidewind3+2718.8*10.477*sidewind4;

    
%%%%%%%%%%%空气阻力及力矩%%%%%%%%%%%%%%%%%%%%%%%%
    if(VA==0) 
        kat=12.0666392;
    else
        kat=Tp/(2*0.5*11.94590607*Roua*VA^2);
    end
    if kat > 12.0666392 
        kat=12.0666392;
    end
    LB=[0,10,20,30,40,50,60,70,80,90,100,110,120,130,140,150,160,170,180];
    LT=[0,1.340737692,2.681475385,4.022213077,5.362950769,6.703688462,8.044426154,9.385163846,10.72590154,12.06663923];
    if kat<=1.340737692
        ia=1;
    elseif kat>1.340737692 && kat<=2.681475385
        ia=2;
    elseif kat>2.681475385 && kat<=4.022213077
        ia=3;
    elseif kat>4.022213077 && kat<=5.362950769
        ia=4;
    elseif kat>5.362950769 && kat<=6.703688462
        ia=5;
    elseif kat>6.703688462 && kat<=8.044426154
        ia=6;
    elseif kat>8.044426154 && kat<=9.385163846
        ia=7;
    elseif kat>9.385163846 && kat<=10.72590154
        ia=8;
    elseif kat>10.72590154
        ia=9;
    else
        ia=9;
    end
    if abs(Abeta)<=10
        ja=1;
    elseif abs(Abeta)>10 && abs(Abeta)<=20
        ja=2;
    elseif abs(Abeta)>20 && abs(Abeta)<=30
        ja=3;
    elseif abs(Abeta)>30 && abs(Abeta)<=40
        ja=4;
    elseif abs(Abeta)>40 && abs(Abeta)<=50
        ja=5;
    elseif abs(Abeta)>50 && abs(Abeta)<=60
        ja=6;
    elseif abs(Abeta)>60 && abs(Abeta)<=70
        ja=7;
    elseif abs(Abeta)>70 && abs(Abeta)<=80
        ja=8;
    elseif abs(Abeta)>80 && abs(Abeta)<=90
        ja=9;
    elseif abs(Abeta)>90 && abs(Abeta)<=100
        ja=10;
    elseif abs(Abeta)>100 && abs(Abeta)<=110
        ja=11;
    elseif abs(Abeta)>110 && abs(Abeta)<=120
        ja=12;
    elseif abs(Abeta)>120 && abs(Abeta)<=130
        ja=13;
    elseif abs(Abeta)>130 && abs(Abeta)<=140
        ja=14;
    elseif abs(Abeta)>140 && abs(Abeta)<=150
        ja=15;
    elseif abs(Abeta)>150 && abs(Abeta)<=160
        ja=16;
    elseif(abs(Abeta)>160 && abs(Abeta)<=170)
        ja=17;
    elseif(abs(Abeta)>170)
        ja=18;
    else
        ja=18;
    end
   Cax0=[0.8807,0.94019,0.97849,0.97992,0.88286,0.60995,0.49602,0.37178,0.20014,-0.00659,-0.21493,-0.50578,-0.73929,-0.91401,-1.09186,-1.19996,-1.1706,-1.06687,-0.99916;
		 0.9713,0.97928,1.0156,1.06764,0.91832,0.67577,0.55799,0.35868,0.16109,-0.0107,-0.31823,-0.52952,-0.7205,-0.9248,-1.17242,-1.1663,-1.08942,-0.96599,-0.78821;
		 1.0237,1.07452,1.10006,1.17818,0.99042,0.76704,0.63285,0.4504,0.10776,-0.07082,-0.28949,-0.41333,-0.62744,-0.88972,-1.08796,-1.17001,-1.10603,-0.97497,-0.741;
		 1.14271,1.14353,1.13773,1.2637,1.0526,0.81505,0.70359,0.59119,0.14135,-0.13499,-0.2954,-0.36485,-0.46873,-0.74917,-1.00622,-1.05039,-1.03382,-0.7896,-0.50612;
		 1.2074,1.19609,1.20594,1.31329,1.10664,0.84776,0.77146,0.63476,0.23595,-0.11556,-0.29152,-0.375,-0.37155,-0.60267,-0.77889,-0.92794,-0.8784,-0.59091,-0.28431;
		 1.2633,1.25008,1.25694,1.38576,1.15501,0.8886,0.83018,0.67392,0.30064,0.02261,-0.26322,-0.35535,-0.27956,-0.34348,-0.59787,-0.75657,-0.6469,-0.40852,-0.08471;
		 1.3198,1.29201,1.32483,1.46634,1.22662,0.92433,0.88446,0.66527,0.37037,0.13554,-0.20978,-0.30864,-0.06937,-0.188,-0.48195,-0.60965,-0.46677,-0.26039,0.14272;
		 1.38811,1.36185,1.39813,1.50591,1.28482,0.97121,0.91883,0.7178,0.48185,0.1418,-0.08576,-0.22165,-0.0211,-0.05054,-0.3653,-0.45421,-0.27071,-0.04235,0.34572;
		 1.50952,1.40742,1.46259,1.56334,1.35564,0.99495,0.98871,0.77412,0.5212,0.21363,0.04382,-0.10561,0.02658,0.03392,-0.34347,-0.29384,-0.05992,0.18509,0.47901;
		 1.53744,1.57005,1.60266,1.63527,1.42001,1.06099,1.06177,0.83996,0.6261,0.30079,0.18866,6.80E-04,0.13014,0.15675,-0.09795,-0.13875,0.11113,0.34507,0.61034];	
    Cax1=Cax0(ia,ja)+(Cax0(ia,ja+1)-Cax0(ia,ja))*(abs(Abeta)-LB(ja))/(LB(ja+1)-LB(ja));
    Cax2=Cax0(ia+1,ja)+(Cax0(ia+1,ja+1)-Cax0(ia+1,ja))*(abs(Abeta)-LB(ja))/(LB(ja+1)-LB(ja));
	Cax=Cax1+(Cax2-Cax1)*(kat-LT(ia))/(LT(ia+1)-LT(ia));
    Cay0=[0,-0.46663,-0.95561,-1.4064,-1.88147,-2.41133,-2.43422,-2.38865,-2.30223,-2.33102,-2.38813,-2.34937,-2.39169,-2.30104,-2.07769,-1.58216,-1.0964,-0.53668,0;
            0,-0.6393,-1.16807,-1.70259,-2.14678,-2.63354,-2.80362,-2.82581,-2.68483,-2.66137,-2.64849,-2.5145,-2.41103,-2.28007,-1.99996,-1.48543,-0.94214,-0.45968,0;
            0,-0.7961,-1.25143,-1.68055,-2.24423,-2.63016,-2.98019,-3.04762,-3.02125,-3.01292,-2.87548,-2.62834,-2.52524,-2.28792,-1.97996,-1.5525,-0.94,-0.34844,0;
            0,-0.64799,-1.15425,-1.59175,-2.20497,-2.60748,-3.05301,-3.18157,-3.13995,-3.22453,-3.12199,-2.78501,-2.67088,-2.37265,-2.08341,-1.66442,-1.15091,-0.56581,0;
            0,-0.70088,-1.23751,-1.68515,-2.30218,-2.71364,-3.04513,-3.37381,-3.31023,-3.43737,-3.28447,-2.99284,-2.77372,-2.45469,-2.26244,-1.77303,-1.11653,-0.53877,0;
            0,-0.76605,-1.27499,-1.75401,-2.39219,-2.79209,-3.09121,-3.58487,-3.50549,-3.61433,-3.51607,-3.28652,-2.88548,-2.5704,-2.33102,-1.77737,-1.11912,-0.60608,0;
            0,-0.7338,-1.27711,-1.74318,-2.40842,-2.8172,-3.0165,-3.67734,-3.59035,-3.74941,-3.63629,-3.35099,-3.08788,-2.54863,-2.2923,-1.69918,-1.03312,-0.40556,0;
            0,-0.70174,-1.27787,-1.83126,-2.46481,-2.85849,-3.05347,-3.81889,-3.71495,-3.80838,-3.7821,-3.46589,-3.20554,-2.66313,-2.33041,-1.74871,-1.06609,-0.40932,0;
            0,-0.70127,-1.29548,-1.92712,-2.53371,-2.93402,-3.11651,-3.99872,-3.83572,-3.96512,-3.93461,-3.67846,-3.39078,-2.8089,-2.47008,-1.81976,-1.11226,-0.45014,0;
            0,-0.64802,-1.29603,-1.94405,-2.55525,-2.96843,-3.15189,-3.99332,-3.91655,-3.99489,-4.05358,-3.6697,-3.46114,-2.79994,-2.37664,-1.76536,-1.03651,-0.37983,0];
    Cay1=Cay0(ia,ja)+(Cay0(ia,ja+1)-Cay0(ia,ja))*(abs(Abeta)-LB(ja))/(LB(ja+1)-LB(ja));
    Cay2=Cay0(ia+1,ja)+(Cay0(ia+1,ja+1)-Cay0(ia+1,ja))*(abs(Abeta)-LB(ja))/(LB(ja+1)-LB(ja));
    Cay=Cay1+(Cay2-Cay1)*(kat-LT(ia))/(LT(ia+1)-LT(ia));
    Cak0=[0,-0.05253,-0.0698,-0.09225,-0.08155,-0.06114,-0.01406,0.02922,0.06976,0.0878,0.0899,0.03987,-0.01604,-0.0407,-0.06131,-0.08691,-0.08537,-0.03925,0;
		0,-0.08285,-0.12467,-0.13767,-0.13096,-0.08576,-0.08423,-0.0479,-0.01029,0.0214,0.02358,-0.01067,-0.04959,-0.09466,-0.11535,-0.11061,-0.09892,-0.05181,0;
		0,-0.11309,-0.12571,-0.13428,-0.14225,-0.12553,-0.12423,-0.10594,-0.09072,-0.05175,-0.05294,-0.04963,-0.06578,-0.10631,-0.09635,-0.11837,-0.10742,-0.03193,0;
		0,-0.08544,-0.1286,-0.13305,-0.16236,-0.14129,-0.13873,-0.16814,-0.17031,-0.13829,-0.11923,-0.11354,-0.11096,-0.11929,-0.13172,-0.16379,-0.13869,-0.07024,0;
		0,-0.09809,-0.1349,-0.14201,-0.18819,-0.16522,-0.15029,-0.21078,-0.21435,-0.2128,-0.18898,-0.1678,-0.15917,-0.17106,-0.19579,-0.20574,-0.15414,-0.07641,0;
		0,-0.1158,-0.15015,-0.17753,-0.22031,-0.21448,-0.18351,-0.26856,-0.28538,-0.26857,-0.24442,-0.21969,-0.20282,-0.20376,-0.21371,-0.22043,-0.16335,-0.10207,0;
		0,-0.10457,-0.16108,-0.18624,-0.24245,-0.22567,-0.19772,-0.28681,-0.3124,-0.3134,-0.28952,-0.25192,-0.22941,-0.21446,-0.22346,-0.22165,-0.13778,-0.0518,0;
		0,-0.11156,-0.16536,-0.19435,-0.2501,-0.25913,-0.21031,-0.3239,-0.36765,-0.36463,-0.34811,-0.32009,-0.28615,-0.24664,-0.25752,-0.2395,-0.18612,-0.07386,0;
		0,-0.10883,-0.17224,-0.24568,-0.2727,-0.27989,-0.24478,-0.36147,-0.40424,-0.40164,-0.39217,-0.36731,-0.34666,-0.26277,-0.30281,-0.26383,-0.20531,-0.08801,0;
		0,-0.0729,-0.14579,-0.21868,-0.2654,-0.26768,-0.22625,-0.3521,-0.41024,-0.4246,-0.42171,-0.41468,-0.35704,-0.27821,-0.28988,-0.29159,-0.20306,-0.10129,0];
	Cak1=Cak0(ia,ja)+(Cak0(ia,ja+1)-Cak0(ia,ja))*(abs(Abeta)-LB(ja))/(LB(ja+1)-LB(ja));
    Cak2=Cak0(ia+1,ja)+(Cak0(ia+1,ja+1)-Cak0(ia+1,ja))*(abs(Abeta)-LB(ja))/(LB(ja+1)-LB(ja));
    Cak=Cak1+(Cak2-Cak1)*(kat-LT(ia))/(LT(ia+1)-LT(ia));
    Can0=[0,-0.01564,-0.05488,-0.11688,-0.1836,-0.21708,-0.18743,-0.11797,0.01352,0.08819,0.1415,0.20187,0.27774,0.28114,0.25267,0.21321,0.16715,0.09278,0;
		0,0.05071,0.03931,-5.18E-04,-0.06672,-0.1685,-0.13163,0.0336,0.16742,0.20977,0.22381,0.24633,0.25335,0.243,0.20449,0.15424,0.10411,0.03902,0;
		0,0.10008,0.06801,0.02806,-0.00829,-0.12871,-0.09605,0.08256,0.28162,0.31792,0.30485,0.29646,0.2877,0.23238,0.16379,0.06622,-0.00416,-0.06742,0;
		0,0.06054,0.05145,0.01989,0.0126,-0.08851,-0.09206,0.1394,0.31546,0.40647,0.39587,0.33889,0.31674,0.23874,0.17724,0.11419,0.03304,-0.04983,0;
		0,0.08384,0.08033,0.06081,0.06317,-0.03372,-0.07042,0.20474,0.38244,0.48717,0.48132,0.41638,0.35266,0.29249,0.25673,0.13407,0.02856,-0.0653,0;
		0,0.10373,0.09285,0.08331,0.09477,0.01754,-0.04355,0.23415,0.43577,0.53742,0.54221,0.50197,0.38553,0.32153,0.2537,0.11783,0.02277,-0.03506,0;
		0,0.09772,0.1074,0.08777,0.12344,0.06493,-0.01536,0.26426,0.49962,0.61381,0.60217,0.56032,0.4584,0.34847,0.25384,0.10661,0.03848,-0.09173,0;
		0,0.09814,0.11414,0.10514,0.14954,0.09517,0.00926,0.28769,0.56043,0.65639,0.66036,0.62734,0.50341,0.35704,0.26886,0.12691,0.03408,-0.11717,0;
		0,0.11171,0.13718,0.13146,0.17674,0.12317,0.04176,0.2955,0.60147,0.72613,0.70197,0.68549,0.58896,0.39995,0.33904,0.1227,0.04542,-0.10291,0;
		0,0.12386,0.14784,0.14513,0.20934,0.16061,0.0671,0.31958,0.62352,0.74995,0.75425,0.7215,0.61435,0.39809,0.29017,0.09922,0.02594,-0.12381,0];
	Can1=Can0(ia,ja)+(Can0(ia,ja+1)-Can0(ia,ja))*(abs(Abeta)-LB(ja))/(LB(ja+1)-LB(ja));
    Can2=Can0(ia+1,ja)+(Can0(ia+1,ja+1)-Can0(ia+1,ja))*(abs(Abeta)-LB(ja))/(LB(ja+1)-LB(ja));
    Can=Can1+(Can2-Can1)*(kat-LT(ia))/(LT(ia+1)-LT(ia));
	Xa=-0.5*Roua*Cax*Sx*VA^2;
	Ya=0.5*sign(Abeta)*Roua*Cay*Sx*VA^2;
	Ka=0.5*sign(Abeta)*Roua*Cak*Sx*VA^2*Lc-0.86*Ya;
	Na=0.5*sign(Abeta)*Roua*Can*Sx*VA^2*Lc+0.658*Ya;

    
%%%%%%%%%%%%%%%%水动力%%%%%%%%%%%%%%%%%%
    HQJ=y(7)*57.3;
    if piaojiao >= 0
        Betaxh = piaojiao;
        HQJxh = HQJ;
    end
    if piaojiao < 0
        Betaxh = -1.0*piaojiao;
        HQJxh = -1.0*HQJ;
    end
    if Betaxh>60.0
        Betaxh=60.0;
    end
    if HQJxh>2.0
        HQJxh=2.0;
    end
    if HQJxh<-3.0
        HQJxh=-3.0;
    end
	V=(u*u+v*v)^0.5;
    Vxh=V;
    if Vxh>18.53
        Vxh=18.53;
    end
	Cxh = zeros(6,14,4);
    Cxh(:,:,1)=[zeros(1,14);
    -26.054,-25.413,-26.836,-28.795,-33.064,-38.182,-41.832,-41.164,-40.72,-40.295,-39.051,-37.881,-35.249,-32.254;
    -39.23,-37.105,-36.82,-38.48,-39.558,-35.374,-31.5,-27.106,-24.754,-21.2,-17.651,-17.05,-16.449,-15.848;
    -36.305,-35.11,-33.515,-34.775,-32.807,-29.956,-26.215,-20.398,-16.505,-13.518,-9.899,-9.501,-9.103,-8.705;
    -35.475,-33.714,-32.047,-31.882,-27.805,-25.731,-20.201,-16.049,-12.302,-9.566,-8.091,-8.529,-8.967,-9.405;
    -34.898,-34.118,-32.627,-29.104,-25.941,-21.058,-17.584,-15.332,-11.99,-8.981,-8.542,-8.103,-7.664,-7.225];
    Cxh(:,:,2)=[zeros(1,14);
    -24.547,-24.642,-24.898,-28.932,-34.142,-40.395,-42.006,-43.518,-43.926,-43.388,-40.599,-39.072,-35.008,-32.513;
    -37.334,-34.192,-34.203,-39.853,-36.779,-35.577,-32.483,-29.395,-26.598,-23.557,-20.573,-18.861,-17.149,-15.437;
    -33.283,-32.118,-32.357,-35.866,-32.272,-30.585,-27.848,-24.256,-20.251,-17.825,-14.917,-12.883,-10.849,-8.815;
    -31.835,-30.336,-30.845,-30.696,-28.807,-26.409,-23.419,-19.65,-15.944,-13.621,-10.177,-8.535,-6.893,-5.251;
    -31.438,-30.1,-29.536,-28.171,-26.087,-24.4,-21.216,-19.194,-15.157,-11.034,-8.636,-6.238,-3.84,-1.442];
    Cxh(:,:,3)=[zeros(1,14);
    -25.686,-26.95,-28.376,-30.942,-35.223,-42.302,-41.33,-42.449,-43.062,-43.68,-43.808,-40,-35.571,-32.338;
    -35.121,-35.326,-35.6,-36.365,-35.231,-33.02,-29.844,-26.784,-24.768,-22.416,-20.625,-19.41,-17.967,-16.18;
    -32.38,-32.105,-31.429,-30.426,-29.489,-26.501,-24.074,-20.246,-22.252,-18.832,-15.703,-14.436,-13.741,-12.611;
    -30.387,-29.222,-28.234,-26.678,-24.744,-22.082,-20.583,-21.762,-19.939,-14.345,-11.362,-10.458,-9.711,-13.165;
    -28.493,-28.384,-28.227,-25.201,-22.552,-21.884,-19.7,-20.8,-18.17,-12.305,-10.973,-9.14,-9.36,-9.851];
    Cxh(:,:,4)=[zeros(1,14);
    -31.296,-32.515,-34.528,-34.693,-37.785,-39.36,-41.911,-43.081,-45.27,-45.923,-47.472,-48.08,-48.202,-48.529;
    -39.432,-43.498,-46.718,-47.392,-46.646,-44.578,-40.64,-37.084,-34.731,-28.364,-25.977,-24.695,-23.413,-22.131;
    -36.16,-40.302,-41.686,-41.868,-43.38,-37.622,-33.809,-27.203,-24.22,-22.404,-21.716,-20.207,-18.688,-17.189;
    -35.852,-38.761,-40.12,-38.252,-35.713,-32.379,-26.918,-24.484,-22.982,-21.625,-20.742,-20.5,-20.258,-20.016;
    -36.212,-37.682,-38.187,-35.23,-33.613,-30.88,-29.34,-25.819,-24.581,-21.924,-22.87,-23.816,-24.762,-25.708];
	 LBeta=[0.0,2.5,5.0,10.0,15.0,20.0,25.0,30.0,35.0,40.0,45.0,50.0,55.0,60.0];
	 LVxh=[0.0,8.24,12.34,14.39,16.48,18.53];
	 LHQJxh=[-3.0,-1.5,0.0,2.0];
     if HQJxh>=-3.0 && HQJxh<-1.5
         ih=1;
     elseif HQJxh>=-1.5 && HQJxh<0.0
         ih=2;
     elseif HQJxh>=0.0 && HQJxh<=2.0
         ih=3;
     end
     if Vxh>=0.0 && Vxh<8.24
         jh=1;
     elseif Vxh>=8.24 && Vxh<12.34
         jh=2;
     elseif Vxh>=12.34 && Vxh<14.39
         jh=3;
     elseif Vxh>=14.39 && Vxh<16.48
         jh=4;
     elseif Vxh>=16.48 && Vxh<=18.53
         jh=5;
     end
     if Betaxh>=0.0 && Betaxh<2.5
         kh=1;
     elseif Betaxh>=2.5 && Betaxh<5.0
         kh=2;
     elseif Betaxh>=5.0 && Betaxh<10.0
         kh=3;
     elseif Betaxh>=10.0 && Betaxh<15.0
         kh=4;
     elseif Betaxh>=15.0 && Betaxh<20.0
         kh=5;
     elseif Betaxh>=20.0 && Betaxh<25.0
         kh=6;
     elseif Betaxh>=25.0 && Betaxh<30.0
         kh=7;
     elseif Betaxh>=30.0 && Betaxh<35.0
         kh=8;
     elseif Betaxh>=35.0 && Betaxh<40.0
         kh=9;
     elseif Betaxh>=40.0 && Betaxh<45.0
         kh=10;
     elseif (Betaxh>=45.0 && Betaxh<50.0)
         kh=11;
     elseif (Betaxh>=50.0 && Betaxh<55.0)
         kh=12;
     elseif Betaxh>=55.0
         kh=13;
     end
    Xh1=Cxh(jh,kh,ih)+(Cxh(jh,kh+1,ih)-Cxh(jh,kh,ih))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Xh2=Cxh(jh+1,kh,ih)+(Cxh(jh+1,kh+1,ih)-Cxh(jh+1,kh,ih))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Xh3=Xh1+(Xh2-Xh1)*(Vxh-LVxh(jh))/(LVxh(jh+1)-LVxh(jh));
    Xh4=Cxh(jh,kh,ih+1)+(Cxh(jh,kh+1,ih+1)-Cxh(jh,kh,ih+1))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Xh5=Cxh(jh+1,kh,ih+1)+(Cxh(jh+1,kh+1,ih+1)-Cxh(jh+1,kh,ih+1))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Xh6=Xh4+(Xh5-Xh4)*(Vxh-LVxh(jh))/(LVxh(jh+1)-LVxh(jh));
	Xh7=Xh3+(Xh6-Xh3)*(HQJxh-LHQJxh(ih))/(LHQJxh(ih+1)-LHQJxh(ih));
	Xdrag=12.5^3*Xh7;
    Cyh=zeros(6,14,4);
    Cyh(:,:,1)=[zeros(1,14);
    -14.274,-16.845,-18.157,-20.346,-23.926,-47.345,-65.722,-74.277,-76.278,-76.261,-77.711,-80.019,-82.65,-89.116;
    -13.656,-18.657,-23.411,-30.33,-47.898,-63.183,-56.419,-52.529,-50.917,-50.103,-48.535,-48.499,-48.463,-48.427;
    -13.24,-20.465,-27.393,-36.125,-55.822,-50.649,-42.677,-42.046,-42.091,-42.712,-41.934,-42.684,-43.434,-44.184;
    -13.992,-22.009,-31.362,-38.186,-50.094,-44.202,-41.206,-40.011,-38.99,-40.095,-41.199,-40.53,-39.861,-39.192;
    -13.233,-22.866,-32.989,-32.763,-42.576,-38.323,-36.739,-36.268,-36.526,-36.69,-38.386,-40.082,-41.778,-43.474];
    Cyh(:,:,2)=[zeros(1,14);
    -6.147,-7.975,-9.969,-12.644,-17.401,-42.919,-58.449,-68.431,-69.818,-71.853,-70.632,-71.755,-73.646,-79.556;
    -5.868,-11.39,-15.138,-34.212,-55.319,-53.728,-47.48,-46.019,-43.363,-38.542,-38.389,-33.56,-28.731,-23.902;
    -5.008,-13.467,-19.503,-43.54,-49.489,-42.168,-38.723,-36.626,-35.038,-33.849,-34.846,-33.104,-31.362,-29.62;
    -7.081,-14.72,-23.75,-45.551,-41.168,-36.735,-31.974,-31.311,-30.823,-30.51,-32.514,-31.867,-31.22,-30.573;
    -6.32,-15.609,-24.507,-41.749,-34.778,-30.783,-27.654,-28.109,-29.237,-29.69,-30.055,-30.42,-30.839,-31.15];
    Cyh(:,:,3)=[zeros(1,14);
    0,-1.569,-3.212,-7.85,-15.562,-42.411,-69.835,-89.586,-97.873,-101.745,-108.165,-109.448,-109.252,-110.913;
    0,-2.54,-7.157,-31.58,-41.075,-54.739,-48.107,-43.959,-43.494,-40.169,-38.761,-37.163,-38.167,-39.133;
    0,-4.385,-12.122,-37.773,-40.691,-42.844,-39.201,-36.133,-37.125,-32.4,-29.334,-29.897,-30.124,-28.684;
    0,-6.329,-18.648,-37.899,-34.601,-36.367,-34.41,-35.651,-31.945,-28.27,-27.782,-27.428,-27.131,-29.801;
    0,-7.114,-22.633,-32.243,-27.556,-31.628,-30.742,-31.447,-30.564,-25.175,-26.333,-26.896,-26.015,-27.322];
    Cyh(:,:,4)=[zeros(1,14);
    11.091,8.563,4.273,-2.071,-13.611,-54.594,-74.661,-90.976,-105.725,-118.322,-132.3,-140.892,-148.781,-153.115;
    7.505,2.891,-3.783,-27.37,-50.534,-68.429,-66.34,-60.269,-50.046,-42.313,-47.139,-43.519,-39.899,-36.279;
    7.431,1.089,-11.56,-35.398,-52.019,-57.022,-44.485,-30.807,-29.028,-31.009,-33.939,-33.857,-33.775,-33.693;
    7.498,-0.361,-9.867,-32.55,-46.155,-32.657,-23.826,-26.408,-25.715,-28.421,-32.464,-32.01,-31.556,-31.102;
    7.196,-1.217,-11.37,-28.197,-23.175,-19.368,-22.99,-21.924,-24.587,-25.931,-30.696,-35.461,-40.226,-44.991];
    Yh1=Cyh(jh,kh,ih)+(Cyh(jh,kh+1,ih)-Cyh(jh,kh,ih))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Yh2=Cyh(jh+1,kh,ih)+(Cyh(jh+1,kh+1,ih)-Cyh(jh+1,kh,ih))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Yh3=Yh1+(Yh2-Yh1)*(Vxh-LVxh(jh))/(LVxh(jh+1)-LVxh(jh));
    Yh4=Cyh(jh,kh,ih+1)+(Cyh(jh,kh+1,ih+1)-Cyh(jh,kh,ih+1))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Yh5=Cyh(jh+1,kh,ih+1)+(Cyh(jh+1,kh+1,ih+1)-Cyh(jh+1,kh,ih+1))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Yh6=Yh4+(Yh5-Yh4)*(Vxh-LVxh(jh))/(LVxh(jh+1)-LVxh(jh));
    Yh7=Yh3+(Yh6-Yh3)*(HQJxh-LHQJxh(ih))/(LHQJxh(ih+1)-LHQJxh(ih));
    Ydrag=sign(piaojiao)*12.5^3*Yh7;
    Ckh = zeros(6,14,4);
    Ckh(:,:,1)=[zeros(1,14);
    10.814,10.917,11.144,10.326,9.075,5.058,4.695,4.863,1.9,-2.151,-4.151,-5.539,-7.054,-8.459;
    10.422,8.977,7.67,3.59,0.586,1.957,3.014,1.245,0.411,-1.153,-0.268,1.051,2.37,3.689;
    10.666,9.029,6.624,2.836,2.636,4.088,4.991,3.262,3.146,3.254,4.851,6.894,8.937,10.98;
    11.65,9.274,6.07,3.999,4.413,4.838,4.34,4.658,5.786,7.66,8.857,9.014,9.171,9.328;
    10.482,8.474,5.084,5.096,6.275,6.202,5.669,6.99,7.72,9.261,9.529,9.797,10.065,10.333];
    Ckh(:,:,2)=[zeros(1,14);
    5.432,5.548,5.556,5.302,2.749,-0.905,-0.328,-0.541,-3.797,-6.631,-9.327,-11.819,-13.768,-15.971;
    3.697,3.249,2.211,-3.351,-5.079,-4.397,-5.19,-5.664,-6.548,-6.346,-6.228,-5.856,-5.484,-5.112;
    4.727,3.342,1.108,-3.864,-3.266,-2.808,-2.672,-2.933,-3.808,-2.917,-2.517,-1.803,-1.089,-0.375;
    5.101,3.391,0.241,-2.519,-1.77,-0.714,-1.301,-1.585,-1.633,-0.829,-0.275,1.226,2.727,4.228;
    5.495,3.347,-0.159,-1.61,-0.72,0.268,-0.138,0.069,0.382,0.555,1.474,2.393,3.312,4.231];
    Ckh(:,:,3)=[zeros(1,14);
    0,0.338,0.765,-2.774,-3.73,-7.126,-2.697,2.666,-0.536,-8.69,-13.861,-16.428,-20.812,-21.648;
    0,-1.069,-2.725,-8.963,-10.125,-11.346,-12.417,-13.438,-13.543,-13.056,-11.356,-10.073,-8.672,-8.186;
    0,-1.482,-4.088,-9.882,-9.417,-10.667,-10.639,-9.959,-10.288,-8.99,-8.029,-6.326,-5.266,-5.209;
    0,-1.817,-5.066,-9.002,-8.129,-8.678,-8.492,-7.857,-7.417,-6.527,-5.339,-4.727,-3.78,-3.402;
    0,-2.282,-5.918,-8,-6.685,-6.946,-7.084,-6.825,-6.517,-5.438,-4.319,-3.839,-3.072,-3.503];
    Ckh(:,:,4)=[zeros(1,14);
    -3.486,-3.045,-3.22,-4.519,-6.809,3.935,4.936,5.515,1.581,-1.974,-10.338,-16.108,-24.115,-29.531;
    -6.549,-6.811,-7.667,-9.859,-9.764,-11.97,-13.243,-16.482,-20.771,-21.991,-22.37,-21.268,-20.166,-19.064;
    -4.552,-5.749,-8.937,-12.125,-11.207,-12.491,-14.211,-15.519,-16.536,-15.072,-14.242,-12.227,-10.212,-8.197;
    -4.918,-7.743,-9.515,-11.08,-10.509,-13.4,-12.957,-12.886,-12.279,-11.889,-11.238,-10.252,-9.266,-8.28;
    -6.234,-8,-10.458,-11.117,-11.57,-12.291,-10.74,-11.331,-10.759,-10.295,-7.954,-5.613,-3.272,-0.931];
    Kh1=Ckh(jh,kh,ih)+(Ckh(jh,kh+1,ih)-Ckh(jh,kh,ih))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Kh2=Ckh(jh+1,kh,ih)+(Ckh(jh+1,kh+1,ih)-Ckh(jh+1,kh,ih))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Kh3=Kh1+(Kh2-Kh1)*(Vxh-LVxh(jh))/(LVxh(jh+1)-LVxh(jh));
    Kh4=Ckh(jh,kh,ih+1)+(Ckh(jh,kh+1,ih+1)-Ckh(jh,kh,ih+1))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Kh5=Ckh(jh+1,kh,ih+1)+(Ckh(jh+1,kh+1,ih+1)-Ckh(jh+1,kh,ih+1))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Kh6=Kh4+(Kh5-Kh4)*(Vxh-LVxh(jh))/(LVxh(jh+1)-LVxh(jh));
    Kh7=Kh3+(Kh6-Kh3)*(HQJxh-LHQJxh(ih))/(LHQJxh(ih+1)-LHQJxh(ih));
    Kdrag=sign(piaojiao)*12.5^4*Kh7;
    Cnh=zeros(6,14,4);
    Cnh(:,:,1)=[zeros(1,14);
    -8.086,-9.668,-10.49,-11.789,-17.334,-10.699,0.878,5.186,6.718,6.033,4.059,2.507,-0.066,-0.254;
    -9.283,-10.087,-9.908,11.117,22.953,11.492,9.977,6.265,4.1,-0.345,-3.649,-5.873,-8.097,-10.321;
    -8.995,-8.111,-6.749,20.118,12.143,8.228,7.399,1.375,-1.951,-2.473,-6.625,-11.066,-15.507,-19.948;
    -9.89,-7.791,-3.498,21.737,9.122,3.353,2.397,-1.458,-4.55,-6.53,-10.211,-12.557,-14.903,-17.249;
    -10.954,-6.862,-2.562,20.532,5.135,0.078,-0.242,-3.984,-6.184,-8.342,-10.465,-12.588,-14.711,-16.834];
    Cnh(:,:,2)=[zeros(1,14);
    -4.91,-5.399,-6.138,-8.726,-12.162,-3.01,4.315,11.72,13.087,10.214,8.95,7.52,6.411,0.25;
    -5.421,-5.991,-5.987,1.577,14.069,13.736,9.763,7.215,5.708,4,1.671,0.533,-0.605,-1.743;
    -5.09,-4.223,-2.336,7.398,13.075,9.567,5.92,4.137,2.803,2.551,1.35,1.333,1.316,1.299;
    -7.949,-3.603,0.941,12.041,10.347,4.899,1.995,1.658,-1.324,-1.672,-4.192,-4.668,-5.144,-5.62;
    -7.512,-2.673,1.014,10.787,7.279,3.55,0.074,-0.334,-1.417,-3.832,-5.875,-7.918,-9.961,-12.004];
    Cnh(:,:,3)=[zeros(1,14);
    0,-1.017,-1.69,-3.317,-7.077,6.883,18.37,28.495,35.467,37.294,40.76,40.974,34.481,29.871;
    0,0.425,0.621,10.496,17.333,23.447,18.671,16.74,13.628,13.02,10.797,8.247,4.514,1.327;
    0,1.457,4.054,17.446,21.688,21.312,17.451,13.589,10.46,11.627,8.57,6.595,1.947,2.267;
    0,3.193,8.158,19.945,20.582,18.634,14.787,12.553,8.768,9.566,6.217,4.214,3.864,4.362;
    0,5.197,11.704,17.62,18.078,16.961,14.133,9.195,7.41,8.473,6.005,3.851,2.566,1.96];
    Cnh(:,:,4)=[zeros(1,14);
    1.284,-0.017,-2.522,-2.31,-6.184,7.224,11.207,16.712,26.338,29.659,38.2,35.828,31.152,23.483;
    5.201,5.24,4.974,13.507,32.452,37.356,38.677,29.944,23.268,14.23,10.702,6.031,1.36,-3.311;
    6.52,7.576,9.674,20.509,31.99,41.957,24.819,11.887,8.713,8.379,2.436,1.733,1.03,0.327;
    7.432,9.847,13.292,20.504,34.254,23.954,12.579,10.093,7.145,6.407,1.756,1.118,0.48,-0.158;
    7.308,9.633,15,21.033,18.579,16.862,16.15,10.322,7.842,7.492,2.232,-3.028,-8.288,-13.548];
    Nh1=Cnh(jh,kh,ih)+(Cnh(jh,kh+1,ih)-Cnh(jh,kh,ih))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Nh2=Cnh(jh+1,kh,ih)+(Cnh(jh+1,kh+1,ih)-Cnh(jh+1,kh,ih))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Nh3=Nh1+(Nh2-Nh1)*(Vxh-LVxh(jh))/(LVxh(jh+1)-LVxh(jh));
    Nh4=Cnh(jh,kh,ih+1)+(Cnh(jh,kh+1,ih+1)-Cnh(jh,kh,ih+1))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Nh5=Cnh(jh+1,kh,ih+1)+(Cnh(jh+1,kh+1,ih+1)-Cnh(jh+1,kh,ih+1))*(Betaxh-LBeta(kh))/(LBeta(kh+1)-LBeta(kh));
    Nh6=Nh4+(Nh5-Nh4)*(Vxh-LVxh(jh))/(LVxh(jh+1)-LVxh(jh));
    Nh7=Nh3+(Nh6-Nh3)*(HQJxh-LHQJxh(ih))/(LHQJxh(ih+1)-LHQJxh(ih));
    Ndrag=sign(piaojiao)*12.5^4*Nh7;
    if V>=0 && V<8.24
        Cyvd = -1.946e-3;
        Cnvd = 5.679e-4;
        Ckvd = 1.155e-4;
    elseif V>=8.24 && V<=16.48
        Cyvd=-1.946e-3+(-3.256e-4+1.946e-3)*(V-8.24)/8.24;
        Cnvd=5.679e-4+(3.521e-4-5.679e-4)*(V-8.24)/8.24;
        Ckvd=1.155e-4+(2.817e-4-1.155e-4)*(V-8.24)/8.24;
    elseif (V>16.48)
        Cyvd=-3.256e-4;
        Cnvd=3.521e-4;
        Ckvd=2.817e-4;
    end  
    Yvd=0.5*Rou*Lc^3*Cyvd*vd_h;
	Nvd=0.5*Rou*Lc^4*Cnvd*vd_h;
	Kvd=0.5*Rou*Lc^4*Ckvd*vd_h;
    Cyvr=[-1.888e-3,-1.888e-3,1.086e-2,5.593e-3,5.387e-3;
          -1.888e-3,-1.888e-3,1.086e-2,5.593e-3,5.387e-3;
           3.38e-3,3.38e-3,-6.267e-4,9.182e-5,3.051e-3;
          -9.09e-6,-9.09e-6,-3.446e-4,1.292e-3,4.032e-3;
          -3.613e-4,-3.613e-4,-5.363e-4,1.018e-3,3.702e-3];
    DV=[0.0,8.24,12.34,16.48,18.53];
    Dbeta=[0.0,10.0,20.0,30.0,45.0];
    Betavr=abs(piaojiao);
    if Betavr>45
        Betavr=45;
    end
    if Betavr>=0.0 && Betavr<10.0
        jvr=1;
    elseif Betavr>=10.0 && Betavr<20.0
        jvr=2;
    elseif Betavr>=20.0 && Betavr<30.0
        jvr=3;
    elseif Betavr>=30.0 && Betavr<=45.0
        jvr=4;
    end    
    if Vxh>=0.0 && Vxh<8.24
        ivr=1;
    elseif Vxh>=8.24 && Vxh<12.34
        ivr=2;
    elseif Vxh>=12.34 && Vxh<16.48
        ivr=3;
    elseif Vxh>=16.48 && Vxh<=18.53
        ivr=4;
    end   
	rx=r;
    if abs(rx)>1.0
        rx=sign(rx)*1.0;
    end
	Cyvr1=Cyvr(ivr,jvr)+(Cyvr(ivr,jvr+1)-Cyvr(ivr,jvr))*(Betavr-Dbeta(jvr))/(Dbeta(jvr+1)-Dbeta(jvr));
    Cyvr2=Cyvr(ivr+1,jvr)+(Cyvr(ivr+1,jvr+1)-Cyvr(ivr+1,jvr))*(Betavr-Dbeta(jvr))/(Dbeta(jvr+1)-Dbeta(jvr));
    Cyvr3=Cyvr1+(Cyvr2-Cyvr1)*(Vxh-DV(ivr))/(DV(ivr+1)-DV(ivr));
	Yvr=0.5*Rou*Lc^3*Cyvr3*abs(vx)*rx;
	Cnvr=[-4.328e-4,-4.328e-4,-3.063e-3,-1.524e-3,-3.593e-4;
		  -4.328e-4,-4.328e-4,-3.063e-3,-1.524e-3,-3.593e-4;
		  -1.108e-3,-1.108e-3,8.797e-4,7.714e-4,4.312e-4;
		  3.682e-4,3.682e-4,5.349e-4,3.057e-4,2.033e-4;
		  7.408e-4,7.408e-4,5.409e-4,3.313e-4,1.752e-4];
    Cnvr1= Cnvr(ivr,jvr)+(Cnvr(ivr,jvr+1)-Cnvr(ivr,jvr))*(Betavr-Dbeta(jvr))/(Dbeta(jvr+1)-Dbeta(jvr));
    Cnvr2= Cnvr(ivr+1,jvr)+(Cnvr(ivr+1,jvr+1)-Cnvr(ivr+1,jvr))*(Betavr-Dbeta(jvr))/(Dbeta(jvr+1)-Dbeta(jvr));
    Cnvr3= Cnvr1+(Cnvr2-Cnvr1)*(Vxh-DV(ivr))/(DV(ivr+1)-DV(ivr));
	Nvr=0.5*Rou*Lc^4*Cnvr3*abs(vx)*rx;
	Ckvr=[-3.089e-3,-3.089e-3,-1.428e-3,-2.995e-4,1.507e-4;
		  -3.089e-3,-3.089e-3,-1.428e-3,-2.995e-4,1.507e-4;
		  -2.251e-3,-2.251e-3,-1.063e-3,-9.215e-4,-7.747e-4;
		  -2.449e-3,-2.449e-3,-1.386e-3,-1.106e-3,-6.976e-4;
		  -2.439e-3,-2.439e-3,-1.410e-3,-1.112e-3,-7.152e-4];
	Ckvr1=Ckvr(ivr,jvr)+(Ckvr(ivr,jvr+1)-Ckvr(ivr,jvr))*(Betavr-Dbeta(jvr))/(Dbeta(jvr+1)-Dbeta(jvr));
    Ckvr2=Ckvr(ivr+1,jvr)+(Ckvr(ivr+1,jvr+1)-Ckvr(ivr+1,jvr))*(Betavr-Dbeta(jvr))/(Dbeta(jvr+1)-Dbeta(jvr));
    Ckvr3=Ckvr1+(Ckvr2-Ckvr1)*(Vxh-DV(ivr))/(DV(ivr+1)-DV(ivr));
	Kvr=0.5*Rou*Lc^4*Ckvr3*abs(vx)*rx;
    HQJr=-abs(y(7))*57.3;
    if HQJr<-3.3
        HQJr=-3.3;
    end
    if HQJr>2.0
        HQJr=2.0;
    end
	DHQJr=[-3.3,-1.65,0.0,2.0];
    if Vxh>=0.0 && Vxh<8.24
        ir=1;
    elseif Vxh>=8.24 && Vxh<12.34
        ir=2;
    elseif Vxh>=12.34 && Vxh<16.48
        ir=3;
    elseif Vxh>=16.48 && Vxh<=18.53
        ir=4;
    end
    if HQJr>=-3.3 && HQJr<-1.65
        jr=1;
    elseif HQJr>=-1.65 && HQJr<0.0
        jr=2;
    elseif HQJr>=0.0 && HQJr<=2.0
        jr=3;
    end
    Cyrd=[ 3.54e-4,2.99e-4,1.901e-4,1.74e-4;
		   3.54e-4,2.99e-4,1.901e-4,1.74e-4;
		   1.768e-4,4.822e-5,-2.81e-4,-3.132e-4;
		  -1.826e-4,-1.009e-5,-3.122e-4,-3.875e-4;
		  -1.369e-4,-8.843e-5,-3.521e-4,-5.464e-4];
    if abs(rd_h)>10.0
        rd_h=10.0*sign(rd_h);
    end
	Cyrd1=Cyrd(ir,jr)+(Cyrd(ir,jr+1)-Cyrd(ir,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cyrd2=Cyrd(ir+1,jr)+(Cyrd(ir+1,jr+1)-Cyrd(ir+1,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cyrd3=Cyrd1+(Cyrd2-Cyrd1)*(Vxh-DV(ir))/(DV(ir+1)-DV(ir));
    Yrd=0.5*Rou*Lc^4*Cyrd3*rd_h;
	Cnrd=[-1.757e-4,-1.422e-4,-8.649e-5,-1.631e-4;
          -1.757e-4,-1.422e-4,-8.649e-5,-1.631e-4;
          -1.519e-4,-1.019e-4,-3.964e-5,-1.169e-4;
          -1.475e-4,-1.017e-4,-3.863e-5,-9.568e-5;
          -1.591e-4,-1.047e-4,-3.602e-5,-9.141e-5];
	Cnrd1=Cnrd(ir,jr)+(Cnrd(ir,jr+1)-Cnrd(ir,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cnrd2=Cnrd(ir+1,jr)+(Cnrd(ir+1,jr+1)-Cnrd(ir+1,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cnrd3=Cnrd1+(Cnrd2-Cnrd1)*(Vxh-DV(ir))/(DV(ir+1)-DV(ir));
    Nrd=0.5*Rou*Lc^5*Cnrd3*rd_h;
	Ckrd=[1.661e-4,1.377e-4,1.153e-4,1.431e-4;
		  1.661e-4,1.377e-4,1.153e-4,1.431e-4;
		  2.108e-4,1.67e-4,1.24e-4,1.579e-4;
		  2.865e-4,2.231e-4,1.726e-4,2.222e-4;
		  3.534e-4,2.614e-4,2.042e-4,2.748e-4];
	Ckrd1=Ckrd(ir,jr)+(Ckrd(ir,jr+1)-Ckrd(ir,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Ckrd2=Ckrd(ir+1,jr)+(Ckrd(ir+1,jr+1)-Ckrd(ir+1,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Ckrd3=Ckrd1+(Ckrd2-Ckrd1)*(Vxh-DV(ir))/(DV(ir+1)-DV(ir));
    Krd=0.5*Rou*Lc^5*Ckrd3*rd_h;
	Cyr=[2.676e-5,5.477e-5,4.18e-6,1.561e-5;
		 2.676e-5,5.477e-5,4.18e-6,1.561e-5;
		-6.104e-4,-2.252e-4,-9.97e-6,-2.453e-4;
		-7.101e-4,-4.646e-4,-3.667e-4,-4.483e-4;
		-7.453e-4,-4.537e-4,-3.408e-4,-4.568e-4];
	Cyr1=Cyr(ir,jr)+(Cyr(ir,jr+1)-Cyr(ir,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cyr2=Cyr(ir+1,jr)+(Cyr(ir+1,jr+1)-Cyr(ir+1,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cyr3=Cyr1+(Cyr2-Cyr1)*(Vxh-DV(ir))/(DV(ir+1)-DV(ir));
    Yrh=0.5*Rou*Lc^3*V*Cyr3*rx;
	Cnr=[-3.071e-4,-3.521e-4,-3.731e-4,-3.294e-4;
		 -3.071e-4,-3.521e-4,-3.731e-4,-3.294e-4;
		  6.683e-5,-3.722e-5,-3.375e-4,-1.155e-4;
		  3.304e-5,8.041e-5,-1.682e-4,2.375e-5;
		  1.351e-4,8.411e-5,-7.039e-5,1.591e-5];
	Cnr1=Cnr(ir,jr)+(Cnr(ir,jr+1)-Cnr(ir,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cnr2=Cnr(ir+1,jr)+(Cnr(ir+1,jr+1)-Cnr(ir+1,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cnr3=Cnr1+(Cnr2-Cnr1)*(Vxh-DV(ir))/(DV(ir+1)-DV(ir));
    Nrh=0.5*Rou*Lc^4*V*Cnr3*rx;
	Ckr=[1.517e-4,2.062e-4,1.655e-4,4.523e-5;
		 1.517e-4,2.062e-4,1.655e-4,4.523e-5;
		 1.51e-4,1.236e-4,3.312e-4,2.64e-5;
		 1.331e-4,1.319e-4,1.923e-4,5.33e-6;
		 1.22e-4,1.268e-4,1.799e-4,1.432e-5];
	Ckr1=Ckr(ir,jr)+(Ckr(ir,jr+1)-Ckr(ir,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Ckr2=Ckr(ir+1,jr)+(Ckr(ir+1,jr+1)-Ckr(ir+1,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Ckr3=Ckr1+(Ckr2-Ckr1)*(Vxh-DV(ir))/(DV(ir+1)-DV(ir));
    Krh=0.5*Rou*Lc^4*V*Ckr3*rx; 
    Yrr = 0;
	 Cnrr=[6.822e-5,7.309e-5,7.406e-5,7.38e-5;
		   6.822e-5,7.309e-5,7.406e-5,7.38e-5;
		   7.155e-4,8.072e-4,1.707e-3,1.5e-3;
		   2.391e-3,1.49e-3,3.605e-3,2.238e-3;
		   2.256e-3,2.092e-3,3.295e-3,3.175e-3];
	Cnrr1=Cnrr(ir,jr)+(Cnrr(ir,jr+1)-Cnrr(ir,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cnrr2=Cnrr(ir+1,jr)+(Cnrr(ir+1,jr+1)-Cnrr(ir+1,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Cnrr3=Cnrr1+(Cnrr2-Cnrr1)*(Vxh-DV(ir))/(DV(ir+1)-DV(ir));
    Nrr=0.5*Rou*Lc^5*Cnrr3*rx*abs(rx);
	 Ckrr=[9.381e-4,6.287e-4,7.551e-4,1.229e-3;
		   9.381e-4,6.287e-4,7.551e-4,1.229e-3;
		   2.304e-3,2.13e-3,6.513e-4,2.937e-3;
		   3.421e-3,3.194e-3,2.274e-3,4.659e-3;
		   4.29e-3,3.829e-3,2.78e-3,5.324e-3];
	Ckrr1=Ckrr(ir,jr)+(Ckrr(ir,jr+1)-Ckrr(ir,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Ckrr2=Ckrr(ir+1,jr)+(Ckrr(ir+1,jr+1)-Ckrr(ir+1,jr))*(HQJr-DHQJr(jr))/(DHQJr(jr+1)-DHQJr(jr));
    Ckrr3=Ckrr1+(Ckrr2-Ckrr1)*(Vxh-DV(ir))/(DV(ir+1)-DV(ir));
    Krr=0.5*Rou*Lc^5*Ckrr3*rx*abs(rx);
    
	Xh=dett(V)*Xdrag;
	Yh=dett(V)*Ydrag+Yvd+Yvr+Yrd+Yrh+Yrr;
	Kh=dett(V)*Kdrag+Kvd+Kvr+Krd+Krh+Krr+0.76*Yh;
	Nh=dett(V)*Ndrag+Nvd+Nvr+Nrd+Nrh+Nrr;
       
    Ckp=-6.24e-5;
	Kp=0.5*Rou*Lc^4*V*Ckp*p;

%%
%%%%%%所有力和力矩的和%%%%%%%%%%%%%%%
    Xw=Xa+Xh ;
    Yw=Ys+Ya+Yh;
    Nw=Ns+Na+Nh+1.0*Ngrav;
%     
%     display(Tp)
%     display(Np)
%     display(Kr)
%     display(Nr)
 %外界未知干扰
 %------三角函数型 干扰-----

%  if k>=2000
% dis(1)=5000*sin(0.01*k);
% dis(2)=1000*cos(0.01*k);
% dis(2)=0;
% dis(4)=400*sin(0.02*k); 
%  end
 %------白噪声型 干扰-----

dis=TimevaringDisturbance(b0);
b0=dis;
Speed_wind=0.00025*dis(1);
Angle_wind=0.003*dis(4);  
disp('wind')
disp(Speed_wind)
disp(Angle_wind)
dis=[0;0;0;0];
	TFX1(1)=Tp+Xs+Xr+Xn+Xa+Xh+dis(1);
	TFX1(2)=Ys+Yr+Yn+Ya+Ys+Yh+dis(2);
    TFX1(3)=Ks+Kr+Kn+Ka+Ks+Kh+1.0*Kgrav+Kp+dis(3);
    TFX1(4)=Ns+Np+Nr+Nn+Ns+Na+Nh+1.0*Ngrav+dis(4);%总的回转力矩   
  
    Tp_fig=Tp;%ui(1)*20000;
    Nr_fig=Nr;
    
N1_fig=dis(1);
N2_fig=dis(2);
N3_fig=dis(3);
N4_fig=dis(4);
%     disp('dis(1)');
%     disp(dis)
    
    TFX(1)=TFX1(1)/Mass;
    TFX(2)=TFX1(2)/Mass;
    TFX(3)=TFX1(3)/Ix;
    TFX(4)=TFX1(4)/Iz;

%%%%%%%%%%%%计算出y的一阶导数，然后通过龙格库塔法求解出y的值%%%%%%%%%%%%%
      ydot=[   TFX(1)+y(2)*y(4);
               TFX(2)-y(1)*y(4);
               TFX(3);
               TFX(4);
               y(1)*cos(y(8))-y(2)*sin(y(8))*cos(y(7));
               y(1)*sin(y(8))+y(2)*cos(y(8))*cos(y(7));
               y(3);
               y(4)*cos(y(7)) ];        
end
